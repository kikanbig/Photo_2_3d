// –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ email –Ω–∞—Å—Ç—Ä–æ–µ–∫
// –ó–∞–ø—É—Å–∫: node test-email.js

require('dotenv').config();
const { testEmailConnection, sendEmail } = require('./backend/services/email');

async function testEmail() {
  console.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ email –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...\n');

  try {
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    console.log('1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SMTP —Å–µ—Ä–≤–µ—Ä—É...');
    const connectionOk = await testEmailConnection();

    if (!connectionOk) {
      console.log('‚ùå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ email —Å–µ—Ä–≤–µ—Ä—É –ù–ï —É–¥–∞–ª–æ—Å—å');
      console.log('\nüîß –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:');
      console.log('   ‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π EMAIL_USER');
      console.log('   ‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π EMAIL_APP_PASSWORD');
      console.log('   ‚Ä¢ Gmail –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ');
      console.log('   ‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é');
      return;
    }

    console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ email —Å–µ—Ä–≤–µ—Ä—É —É—Å–ø–µ—à–Ω–æ!');

    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∏—Å—å–º–∞
    console.log('\n2Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∏—Å—å–º–∞...');

    await sendEmail({
      to: process.env.EMAIL_USER, // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–µ–±–µ
      subject: '–¢–µ—Å—Ç Photo to 3D - Email —Ä–∞–±–æ—Ç–∞–µ—Ç!',
      html: `
        <h2>üéâ Email –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ!</h2>
        <p>–ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ —ç—Ç–æ –ø–∏—Å—å–º–æ, –∑–Ω–∞—á–∏—Ç:</p>
        <ul>
          <li>‚úÖ EMAIL_USER –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π</li>
          <li>‚úÖ EMAIL_APP_PASSWORD –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π</li>
          <li>‚úÖ SMTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
        </ul>
        <p>–¢–µ–ø–µ—Ä—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!</p>
        <br>
        <p><small>Photo to 3D - –¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ</small></p>
      `
    });

    console.log('‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
    console.log('üìß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫');

  } catch (error) {
    console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ email:', error.message);
    console.log('\nüîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:');
    console.log('1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://myaccount.google.com/security');
    console.log('2. –í–∫–ª—é—á–∏—Ç–µ 2FA (–¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é)');
    console.log('3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: App passwords ‚Üí Mail ‚Üí Other');
    console.log('4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ 16-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å');
    console.log('5. –î–æ–±–∞–≤—å—Ç–µ –≤ Railway: EMAIL_APP_PASSWORD=–≤–∞—à_–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å');
  }
}

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
if (require.main === module) {
  testEmail();
}

module.exports = { testEmail };
